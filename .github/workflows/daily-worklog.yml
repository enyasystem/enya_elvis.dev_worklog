name: Daily Worklog Update

on:
  schedule:
    # runs daily at 00:00 Africa/Lagos (UTC+1) -> 23:00 UTC previous day
    - cron: '0 23 * * *'
  workflow_dispatch: {}

jobs:
  update-worklog:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Generate yesterday's worklog section
        run: |
          YESTERDAY=$(date -u -d '1 day ago' +%Y-%m-%d)
          python scripts/generate_worklog.py --day "$YESTERDAY"

      - name: Commit changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add worklogs/*.md
          git commit -m "chore(worklog): daily update (auto)" || echo "no changes"
          git push
